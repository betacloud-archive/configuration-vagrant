# This file is subject to the terms and conditions defined in file 'LICENSE',
# which is part of this repository.
#
# DO NOT EDIT THIS FILE BY HAND -- FILE IS SYNCHRONIZED REGULARLY
---
- name: Gather facts from all nodes
  hosts: all
  tasks: []

- name: Apply role debops.grub
  hosts: all
  become: true

  roles:
  - role: debops.grub
    tags: grub
    when: ansible_os_family == 'Debian'

# NOTE: In the future this will be changed to betacloud.firewall
- name: Apply role betacloud.ufw
  hosts: all

  roles:
  - role: betacloud.ufw
    tags: ufw
    when: ansible_os_family == 'Debian'

- name: Apply role betacloud.proxy
  hosts: all:!xenserver
  become: true

  pre_tasks:
  - name: Include secrets
    include_vars: secrets.yml

  roles:
  - role: betacloud.proxy
    when:
      - betacloud_proxy|bool
    tags: proxy

- name: Apply role ANXS.hostname
  hosts: all:!xenserver
  become: true

  roles:
  - role: ANXS.hostname
    tags: hostname

- name: Apply role betacloud.bootstrap
  hosts: all:!xenserver

  pre_tasks:
  - name: Include secrets
    include_vars: secrets.yml

  roles:
  - role: betacloud.bootstrap
    tags: bootstrap

- name: Apply role network-interfaces
  hosts: all
  become: true
  serial: 1

  roles:
  - role: network-interfaces
    when:
      - betacloud_networking|bool
      - ansible_os_family == 'Debian'
    tags: network

- name: Apply role betacloud.docker
  hosts: all:!xenserver
  serial: 1

  pre_tasks:
  - name: Include secrets
    include_vars: secrets.yml

  roles:
  - role: betacloud.docker
    tags: docker

- name: Apply role openstack-ansible-security
  hosts: all:!xenserver
  become: true

  roles:
  - role: openstack-ansible-security
    when: betacloud_system_hardening|bool
    tags: security

- name: Apply role betacloud.letsencrypt
  hosts: all:!xenserver

  roles:
  - role: betacloud.letsencrypt
    when: betacloud_letsencrypt|bool
    tags: letsencrypt
