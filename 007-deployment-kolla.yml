# This file is subject to the terms and conditions defined in file 'LICENSE',
# which is part of this repository.
#
# DO NOT EDIT THIS FILE BY HAND -- FILE IS SYNCHRONIZED REGULARLY
---
- name: Deploy environment with kolla-ansible
  hosts: seed

  tasks:
  - name: Pull required kolla images
    command: "docker exec -t bc-kolla-ansible ansible-playbook -i /config/inventory -e @/config/globals.yml -e @/config/passwords.yml -e @/config/images.yml -e CONFIG_DIR=/config -e action=pull /usr/local/share/kolla-ansible/ansible/site.yml"

  - name: Deploy infrastructure components
    command: "docker exec -t bc-kolla-ansible ansible-playbook -i /config/inventory -e @/config/globals.yml -e @/config/passwords.yml -e @/config/images.yml -e CONFIG_DIR=/config -e action=deploy /usr/local/share/kolla-ansible/ansible/{{ item }}.yml"
    with_items:
      - elasticsearch
      - telegraf
      - haproxy
      - kibana
      - memcached
      - mariadb
      - rabbitmq

  - name: Deploy base openstack components
    command: "docker exec -t bc-kolla-ansible ansible-playbook -i /config/inventory -e @/config/globals.yml -e @/config/passwords.yml -e @/config/images.yml -e CONFIG_DIR=/config -e action=deploy /usr/local/share/kolla-ansible/ansible/{{ item }}.yml"
    with_items:
      - keystone
